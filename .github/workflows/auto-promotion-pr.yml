name: Auto Promotion PR (QA → SIT)

on:
  push:
    branches:
      - qa

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest

    steps:
      - name: Create PR from QA to SIT
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // Check if PR already exists
            const prs = await github.rest.pulls.list({
              owner,
              repo,
              head: `${owner}:qa`,
              base: 'sit',
              state: 'open'
            });

            if (prs.data.length === 0) {
              await github.rest.pulls.create({
                owner,
                repo,
                title: 'Auto Promotion: QA → SIT',
                head: 'qa',
                base: 'sit',
                body: 'Auto-generated PR after successful merge to QA.'
              });
              console.log('PR created: QA → SIT');
            } else {
              console.log('PR already exists. Skipping.');
            }
